generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model rooms {
    id          Int       @id @default(autoincrement())
    name        String    @unique @db.VarChar(255)
    is_active   Boolean   @default(true)
    created_at  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime  @updatedAt
    deleted_at  DateTime? @db.DateTime(6)

    bookings    room_bookings[]

    @@index([is_active])
    @@index([deleted_at])
}

model room_bookings {
    id            Int       @id @default(autoincrement())
    room_id       Int
    room          rooms     @relation(fields: [room_id], references: [id])
    title         String    @db.VarChar(255)
    description   String?   @db.Text
    start_time    DateTime  @db.DateTime()
    end_time      DateTime  @db.DateTime()
    organizer_id  Int
    organizer     users     @relation("RoomBookingOrganizer", fields: [organizer_id], references: [id])
    created_at    DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime  @updatedAt
    deleted_at    DateTime? @db.DateTime(6)

    @@index([room_id])
    @@index([organizer_id])
    @@index([start_time])
    @@index([end_time])
    @@index([deleted_at])
    @@index([room_id, start_time, end_time])
}

model education {
    id          Int       @id @default(autoincrement())
    user_id     Int
    user        users     @relation(fields: [user_id], references: [id])
    name        String    @db.VarChar(255)
    major       String    @db.VarChar(255)
    description String    @db.VarChar(255)
    start_date  DateTime  @db.Date
    end_date    DateTime  @db.Date
    created_at  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime  @updatedAt
    deleted_at  DateTime? @db.DateTime()

    @@index([user_id])
}

model experience {
    id         Int       @id @default(autoincrement())
    user_id    Int
    user       users     @relation(fields: [user_id], references: [id])
    job_title  String    @db.VarChar(255)
    company    String    @db.VarChar(255)
    start_date DateTime  @db.Date
    end_date   DateTime  @db.Date
    created_at DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime  @updatedAt
    deleted_at DateTime? @db.DateTime()

    @@index([user_id])
}

model divisions {
    id                       Int                        @id @default(autoincrement())
    name                     String
    type                     DivisionType?
    status                   DivisionStatus?
    address                  String?
    parent_id                Int?
    parent                   divisions?                 @relation("DivisionParent", fields: [parent_id], references: [id])
    children                 divisions[]                @relation("DivisionParent")
    founding_at              DateTime
    description              String?
    created_at               DateTime                   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at               DateTime                   @updatedAt
    deleted_at               DateTime?                  @db.DateTime(6)
    user_division            user_division[]
    rotation_member          rotation_members[]
    projects                 projects[]
    teams                    teams[]

    @@index([parent_id])
    @@index([type])
    @@index([status])
}

model levels {
    id                   Int                    @id @default(autoincrement())
    name                 String                 @db.VarChar(255)
    coefficient          Float                  @db.Float
    created_at           DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime               @updatedAt
    deleted_at           DateTime?              @db.DateTime(6)
    user_information     user_information[]
}

model migrations {
    id        Int    @id @default(autoincrement()) @db.UnsignedInt
    migration String @db.VarChar(255)
    batch     Int
}

model permissions {
    id              Int               @id @default(autoincrement())
    name            String            @unique @db.VarChar(255)
    created_at      DateTime          @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at      DateTime          @updatedAt
    deleted_at      DateTime?         @db.DateTime(6)
    permission_role permission_role[]
}

model positions {
    id                Int                @id @default(autoincrement())
    name              String             @db.VarChar(255)
    is_active_project Boolean            @default(false)
    created_at        DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at        DateTime           @updatedAt
    deleted_at        DateTime?          @db.DateTime(6)
    skills            skills[]
    user_information  user_information[]
}

model roles {
    id                   Int                    @id @default(autoincrement())
    name                 String                 @unique @db.VarChar(255)
    created_at           DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime               @updatedAt
    deleted_at           DateTime?              @db.DateTime(6)
    allocations          allocations[]
    permission_role      permission_role[]
    user_role_assignment user_role_assignment[]
}

model skills {
    id          Int           @id @default(autoincrement())
    name        String        @unique @db.VarChar(255)
    position_id Int
    position    positions     @relation(fields: [position_id], references: [id])
    created_at  DateTime      @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime      @updatedAt
    deleted_at  DateTime?     @db.DateTime(6)
    user_skills user_skills[]
    allocations allocations[]

    @@index([position_id])
}

model user_information {
    id             Int                   @id @default(autoincrement())
    user_id        Int                   @unique
    user           users                 @relation(fields: [user_id], references: [id])
    personal_email String?               @db.VarChar(255)
    nationality    String?               @db.VarChar(255)
    name           String?               @db.VarChar(255)
    code           String?               @db.VarChar(255)
    avatar         String?               @db.VarChar(255)
    gender         String?               @db.VarChar(255)
    marital        String?               @db.VarChar(255)
    birthday       DateTime?             @db.Date()
    position_id    Int?
    position       positions?            @relation(fields: [position_id], references: [id])
    address        String?               @db.VarChar(255)
    temp_address   String?               @db.VarChar(255)
    phone          String?               @db.VarChar(255)
    tax_code       String?               @db.VarChar(255)
    status         UserInformationStatus @default(ACTIVE)
    description    String?               @db.VarChar(255)
    level_id       Int?
    level          levels?               @relation(fields: [level_id], references: [id])
    note           String?               @db.Text
    overview       String?               @db.Text
    expertise      String?               @db.VarChar(255)
    technique      String?               @db.VarChar(255)
    main_task      String?               @db.VarChar(255)
    language_id    Int?
    language       languages?            @relation(fields: [language_id], references: [id])
    created_at     DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime              @updatedAt
    deleted_at     DateTime?             @db.DateTime(6)

    @@index([user_id])
    @@index([position_id])
    @@index([level_id])
    @@index([language_id])
}

model languages {
    id               Int                @id @default(autoincrement())
    name             String             @db.VarChar(255)
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt
    deleted_at       DateTime?          @db.DateTime(6)
    user_information user_information[]

    @@index([name])
}

model user_skills {
    id                Int       @id @default(autoincrement()) @db.UnsignedInt
    skill_id          Int
    skill             skills    @relation(fields: [skill_id], references: [id])
    user_id           Int
    user              users     @relation(fields: [user_id], references: [id])
    experience        Int
    months_experience Int
    is_main           Boolean   @default(false)
    created_at        DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at        DateTime  @updatedAt
    deleted_at        DateTime? @db.DateTime(6)

    @@index([user_id])
    @@index([skill_id])
}

model activity_log {
    id           Int      @id @default(autoincrement())
    log_name     String   @db.VarChar(255)
    description  String   @db.Text
    subject_type String   @db.VarChar(255)
    event        String   @db.VarChar(255)
    subject_id   Int
    subject      users    @relation("Subject", fields: [subject_id], references: [id])
    causer_type  String   @db.VarChar(255)
    causer_id    Int
    causer       users    @relation("Causer", fields: [causer_id], references: [id])
    properties   Json
    batch_uuid   String   @db.Char(36)
    created_at   DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at   DateTime @updatedAt
}

model files {
    id            Int      @id @default(autoincrement())
    name          String   @db.VarChar(255)
    path          String   @db.VarChar(255)
    mime_type     String   @db.VarChar(255)
    type          Int
    fileable_id   Int
    fileable_type String   @db.VarChar(255)
    created_at    DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime @updatedAt

    @@index([fileable_type, fileable_id])
    @@index([type])
}

model permission_role {
    id            Int         @id @default(autoincrement())
    permission_id Int
    permission    permissions @relation(fields: [permission_id], references: [id])
    role_id       Int
    role          roles       @relation(fields: [role_id], references: [id])
    created_at    DateTime    @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime    @updatedAt

    @@index([permission_id])
    @@index([role_id])
}

model allocations {
    id          Int       @id @default(autoincrement())
    user_id     Int
    user        users     @relation(fields: [user_id], references: [id])
    start_date  DateTime  @db.Date
    end_date    DateTime  @db.Date
    man_day     Int
    allocation  Int
    skill_id    Int
    skill       skills    @relation(fields: [skill_id], references: [id])
    coefficient Float     @db.Double
    created_at  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime  @updatedAt
    role_id     Int
    role        roles     @relation(fields: [role_id], references: [id])
    deleted_at  DateTime? @db.DateTime()

    @@index([user_id])
    @@index([skill_id])
    @@index([role_id])
    @@index([start_date, end_date])
}

model daily_reports {
    id               Int                @id @default(autoincrement())
    user_id          Int
    user             users              @relation(fields: [user_id], references: [id])
    project_id       Int
    project          projects           @relation(fields: [project_id], references: [id])
    coefficient      Float              @db.Double
    tool_type        ToolType           @default(OTHER)
    issue_key        String?            @db.VarChar(255)
    title            String?            @db.MediumText
    work_date        DateTime           @db.Date
    process_type     ProcessType        @default(ANALYSIS)
    actual_time      Float              @db.Double
    status           DailyReportStatus? @default(PENDING)
    link_backlog     String?            @db.MediumText
    issue_properties Json?
    description      String?            @db.Text
    reject_reason    String?            @db.MediumText
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt

    @@index([user_id])
    @@index([project_id])
    @@index([work_date])
    @@index([status])
    @@index([issue_key])
}

model otp_codes {
    id         Int      @id @default(autoincrement())
    email      String   @db.VarChar(255)
    code       String   @db.VarChar(6)
    type       OtpType  @default(PASSWORD_RESET)
    expires_at DateTime @db.DateTime()
    is_used    Boolean  @default(false)
    created_at DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime @updatedAt

    @@index([email])
    @@index([code])
    @@index([type])
    @@index([expires_at])
}


model projects {
    id                   Int                  @id @default(autoincrement())
    name                 String
    code                 String
    status               ProjectStatus        @default(OPEN)
    division_id          Int?
    division             divisions?           @relation(fields: [division_id], references: [id])
    team_id              Int?
    team                 teams?               @relation(fields: [team_id], references: [id])
    project_type         ProjectType?
    billable             Float?
    budget               Float?
    rank                 Int?
    industry             IndustryType?
    scope                String?
    number_process_apply Int?
    description          String?
    critical             String?
    note                 String?
    start_date           DateTime
    end_date             DateTime
    created_at           DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime             @updatedAt
    deleted_at           DateTime?            @db.DateTime()
    daily_reports        daily_reports[]
    over_times_history   over_times_history[]

    @@index([deleted_at])
    @@index([division_id])
    @@index([team_id])
}


model users {
    id                               Int                       @id @default(autoincrement())
    email                            String                    @unique @db.VarChar(255)
    email_verified_at                DateTime                  @db.DateTime()
    password                         String?                   @db.VarChar(255)
    created_at                       DateTime                  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at                       DateTime                  @updatedAt
    deleted_at                       DateTime?                 @db.DateTime()
    education                        education[]
    experience                       experience[]
    user_information                 user_information?
    user_skills                      user_skills[]
    rotation_members                 rotation_members[]
    user_division                    user_division[]
    attendance_logs                  attendance_logs[]
    attendance_sessions              attendance_sessions[]
    day_offs                         day_offs[]                @relation("user")
    approved_by_user                 day_offs[]                @relation("approved_by_user")
    time_sheets                      time_sheets[]
    allocations                      allocations[]
    daily_reports                    daily_reports[]
    activity_log_subject             activity_log[]            @relation("Subject")
    activity_log_causer              activity_log[]            @relation("Causer")
    remote_work_requests             remote_work_requests[]
    approved_remote_work_requests    remote_work_requests[]    @relation("RemoteWorkApprover")
    over_times_history_approved      over_times_history[]      @relation("approved_by_user")
    over_times_history_subject       over_times_history[]      @relation("user")
    user_leave_balance               user_leave_balances?
    leave_transactions               leave_transactions[]
    late_early_requests              late_early_requests[]
    approved_late_early_requests     late_early_requests[]     @relation("LateEarlyApprover")
    forgot_checkin_requests          forgot_checkin_requests[]
    approved_forgot_checkin_requests forgot_checkin_requests[] @relation("ForgotCheckinApprover")
    assigned_assets                  assets[]                  @relation("AssetAssignedUser")
    created_assets                   assets[]                  @relation("AssetCreator")
    asset_requests                   asset_requests[]
    approved_asset_requests          asset_requests[]          @relation("AssetRequestApprover")
    authored_news                    news[]                    @relation("NewsAuthor")
    reviewed_news                    news[]                    @relation("NewsReviewer")
    created_notifications            notifications[]           @relation("NotificationCreator")
    user_notifications               user_notifications[]
    room_bookings_organized          room_bookings[]           @relation("RoomBookingOrganizer")
    user_role_assignments            user_role_assignment[]
    assigned_role_assignments        user_role_assignment[]    @relation("UserRoleAssigner")
}

model checkouts {
    id            Int      @id @default(autoincrement())
    user_id       Int
    checkout_date DateTime @db.Date
    status        Int
    request_id    Int?

    created_at DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime  @updatedAt
    deleted_at DateTime? @db.DateTime()

    @@index([user_id])
    @@index([request_id])
}

model day_offs {
    id                       Int                  @id @default(autoincrement())
    user_id                  Int
    user                     users                @relation("user", fields: [user_id], references: [id])
    work_date                DateTime             @db.Date // Ngày nghỉ
    duration                 DayOffDuration       @default(FULL_DAY)
    status                   DayOffStatus         @default(PENDING)
    type                     DayOffType           @default(PAID)
    title                    String               @db.VarChar(255) // Tiêu đề đơn xin nghỉ
    reason                   String?              @db.Text // Lý do nghỉ phép
    approved_by              Int? // ID người duyệt
    approved_by_user         users?               @relation("approved_by_user", fields: [approved_by], references: [id])
    approved_at              DateTime?            @db.DateTime() // Thời gian duyệt
    rejected_reason          String?              @db.Text // Lý do từ chối
    is_past                  Boolean              @default(false) // Nghỉ phép bù (đã làm trước)
    balance_deducted         Boolean              @default(false) // Đã trừ leave balance chưa
    deduction_transaction_id Int? // ID của leave transaction khi trừ balance
    created_at               DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at               DateTime             @updatedAt
    deleted_at               DateTime?            @db.DateTime()
    time_sheets              time_sheets[]
    leave_transactions       leave_transactions[] @relation("DayOffTransactions")

    @@index([user_id])
    @@index([status])
    @@index([work_date])
    @@index([user_id, status]) 
    @@index([user_id, work_date]) 
    @@index([duration])
    @@index([deleted_at]) 
    @@index([approved_by])
    @@index([balance_deducted])
    @@index([deduction_transaction_id])
}

model holidays {
    id          Int           @id @default(autoincrement())
    name        String        @db.VarChar(255)
    type        HolidayType
    status      HolidayStatus
    start_date  DateTime      @db.Date
    end_date    DateTime      @db.Date
    description String?       @db.VarChar(255)
    created_at  DateTime      @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime      @updatedAt
    deleted_at  DateTime?     @db.DateTime()

    @@index([start_date])
    @@index([end_date])
    @@index([start_date, end_date])
    @@index([status])
    @@index([deleted_at])
}

model time_sheets {
    id      Int   @id @default(autoincrement())
    user_id Int
    user    users @relation(fields: [user_id], references: [id])
    work_date DateTime         @db.Date 
    type      TimesheetType?   @default(NORMAL) 
    status    TimesheetStatus? @default(PENDING) 
    checkin          DateTime? @db.DateTime() 
    checkout         DateTime? @db.DateTime() 
    checkin_checkout String?
    work_time_morning   Int? 
    work_time_afternoon Int?
    total_work_time     Int?
    break_time          Int?
    late_time           Int? 
    late_time_approved  Int?
    early_time          Int?
    early_time_approved Int?
    remote RemoteType? @default(OFFICE)
    day_off_id Int?
    day_off    day_offs? @relation(fields: [day_off_id], references: [id])
    has_forgot_checkin_request Boolean? @default(false)
    has_late_early_request     Boolean? @default(false)
    has_remote_work_request    Boolean? @default(false)
    forgot_checkin_approved    Boolean? @default(false)
    late_early_approved        Boolean? @default(false)
    remote_work_approved       Boolean? @default(false)
    is_complete Boolean? @default(false) 
    created_at DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime  @updatedAt
    deleted_at DateTime? @db.DateTime()
    attendance_logs         attendance_logs[] 
    attendance_sessions     attendance_sessions[] 
    late_early_requests     late_early_requests[] 
    forgot_checkin_requests forgot_checkin_requests[] 
    remote_work_requests    remote_work_requests[] 
    @@unique([user_id, work_date]) 
    @@index([user_id])
    @@index([work_date])
    @@index([user_id, work_date])
    @@index([status])
    @@index([type])
    @@index([deleted_at])
    @@index([work_date, status])
    @@index([user_id, status])
    @@index([user_id, work_date, status])
    @@index([day_off_id])
    @@index([remote])
    @@index([has_forgot_checkin_request])
    @@index([has_late_early_request])
    @@index([has_remote_work_request])
    @@index([work_date, remote])
    @@index([user_id, type, work_date])
}

model attendance_sessions {
    id             Int              @id @default(autoincrement())
    user_id        Int
    user           users            @relation(fields: [user_id], references: [id])
    timesheet_id   Int? 
    timesheet      time_sheets?     @relation(fields: [timesheet_id], references: [id])
    work_date      DateTime         @db.Date 
    session_type   SessionType 
    checkin_time   DateTime?        @db.DateTime()
    checkout_time  DateTime?        @db.DateTime()
    duration       Int? 
    is_open        Boolean          @default(true) // Phiên đã đóng chưa
    location_type  LocationType? // 'office', 'remote', 'client_site'
    checkin_photo  String?          @db.VarChar(500) // Ảnh selfie check in
    checkout_photo String?          @db.VarChar(500) // Ảnh selfie check out
    note           String?          @db.Text // Ghi chú
    status         TimesheetStatus? @default(PENDING) // 0: pending, 1: approved, 2: rejected
    created_at     DateTime         @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime         @updatedAt
    deleted_at     DateTime?        @db.DateTime()

    attendance_logs attendance_logs[] // Relation với attendance_logs

    @@index([user_id])
    @@index([work_date])
    @@index([user_id, work_date])
    @@index([session_type])
    @@index([checkin_time])
    @@index([checkout_time])
    @@index([timesheet_id])
    @@index([status])
    @@index([user_id, work_date, session_type]) // Để tìm session theo user, ngày và loại
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model attendance_logs {
    id              Int                  @id @default(autoincrement())
    user_id         Int
    user            users                @relation(fields: [user_id], references: [id])
    timesheet_id    Int? // Link tới time_sheets
    timesheet       time_sheets?         @relation(fields: [timesheet_id], references: [id])
    session_id      Int? // Link tới attendance_sessions
    session         attendance_sessions? @relation(fields: [session_id], references: [id])
    action_type     String               @db.VarChar(20) // 'checkin', 'checkout', 'break_start', 'break_end'
    timestamp       DateTime             @db.DateTime() // Thời gian thực hiện hành động
    work_date       DateTime             @db.Date // Ngày làm việc
    location_type   String?              @db.VarChar(20) // 'office', 'remote', 'client_site'
    photo_url       String?              @db.VarChar(500) // Ảnh selfie check in/out
    note            String?              @db.Text // Ghi chú
    itempodency_key String?              @db.VarChar(255) // Mã định danh check in/out từ thiết bị
    is_manual       Boolean              @default(false) // Check in/out thủ công bởi admin
    status          TimesheetStatus?     @default(PENDING) // 0: pending, 1: approved, 2: rejected
    created_at      DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at      DateTime             @updatedAt
    deleted_at      DateTime?            @db.DateTime()

    @@index([user_id])
    @@index([work_date])
    @@index([user_id, work_date])
    @@index([action_type])
    @@index([timestamp])
    @@index([timesheet_id])
    @@index([session_id])
    @@index([status])
    @@index([itempodency_key])
    @@index([user_id, action_type, work_date]) // Để kiểm tra checkin/checkout trong ngày
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model schedule_works {
    id                   Int            @id @default(autoincrement())
    start_date           DateTime
    end_date             DateTime
    hour_start_morning   DateTime
    hour_end_morning     DateTime
    hour_start_afternoon DateTime
    hour_end_afternoon   DateTime
    type                 WorkShiftType? @default(NORMAL)
    name                 String?
    created_at           DateTime       @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime       @updatedAt
    deleted_at           DateTime?      @db.DateTime()

    @@index([start_date])
    @@index([end_date])
    @@index([type])
}

enum RotationType {
    PERMANENT
    TEMPORARY
}

model rotation_members {
    id            Int       @id @default(autoincrement())
    division_id   Int
    division      divisions @relation(fields: [division_id], references: [id])
    user_id       Int
    user          users     @relation(fields: [user_id], references: [id])
    type          RotationType
    date_rotation DateTime
    created_at    DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime  @updatedAt
    deleted_at    DateTime? @db.DateTime()

    @@index([division_id])
    @@index([user_id])
}

model over_times_history {
    id               Int              @id @default(autoincrement())
    user_id          Int
    user             users            @relation("user", fields: [user_id], references: [id])
    work_date        DateTime         @db.Date // Ngày làm tăng ca
    title            String           @db.VarChar(255) // Tiêu đề đơn xin tăng ca
    start_time       DateTime         @db.Time() // Thời gian bắt đầu (chỉ giờ:phút)
    end_time         DateTime         @db.Time() // Thời gian kết thúc (chỉ giờ:phút)
    total_hours      Float? // Tổng số giờ tăng ca
    hourly_rate      Float? // Mức lương theo giờ
    total_amount     Float? // Tổng tiền tăng ca
    project_id       Int?
    project          projects?        @relation(fields: [project_id], references: [id])
    reason           String?          @db.Text // Lý do tăng ca
    status           TimesheetStatus? @default(PENDING)
    approved_by      Int? // ID người duyệt
    approved_by_user users?           @relation("approved_by_user", fields: [approved_by], references: [id])
    approved_at      DateTime?        @db.DateTime()
    rejected_reason  String?          @db.Text
    created_at       DateTime         @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime         @updatedAt
    deleted_at       DateTime?        @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_overtime")
    @@index([user_id])
    @@index([work_date])
    @@index([project_id])
    @@index([user_id, work_date]) // Để lọc overtime theo user và ngày
    @@index([status])
    @@index([approved_by])
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model over_times {
    id                 Int       @id @default(autoincrement())
    type               Int?
    start_first_shift  DateTime
    end_first_shift    DateTime
    first_coefficient  Float?
    start_second_shift DateTime
    end_second_shift   DateTime
    second_coefficient Float?
    start_third_shift  DateTime
    end_third_shift    DateTime
    third_coefficient  Float?
    created_at         DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at         DateTime  @updatedAt
    deleted_at         DateTime? @db.DateTime()
}

model user_division {
    id          Int        @id @default(autoincrement())
    userId      Int
    user        users      @relation(fields: [userId], references: [id])
    divisionId  Int?
    division    divisions? @relation(fields: [divisionId], references: [id])
    teamId      Int?
    team        teams?     @relation(fields: [teamId], references: [id])
    description String?

    created_at DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime  @updatedAt
    deleted_at DateTime? @db.DateTime()

    @@index([userId])
    @@index([divisionId])
    @@index([teamId])
    @@index([deleted_at])
}

model user_role_assignment {
    id          Int       @id @default(autoincrement())
    user_id     Int
    role_id     Int
    scope_type  ScopeType
    scope_id    Int? 
    assigned_by Int
    created_at  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime  @updatedAt
    deleted_at  DateTime? @db.DateTime()
    user     users @relation(fields: [user_id], references: [id])
    role     roles @relation(fields: [role_id], references: [id])
    assigner users @relation("UserRoleAssigner", fields: [assigned_by], references: [id])

    @@unique([user_id, role_id, scope_type, scope_id], name: "unique_user_role_scope")
    @@index([user_id])
    @@index([role_id])
    @@index([scope_type, scope_id])
    @@index([assigned_by])
    @@index([deleted_at])
}

model teams {
    id            Int             @id @default(autoincrement())
    name          String          @db.VarChar(255)
    division_id   Int?
    division      divisions?      @relation(fields: [division_id], references: [id])
    founding_date DateTime?       @db.Date
    created_at    DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime        @updatedAt
    deleted_at    DateTime?       @db.DateTime()
    user_division user_division[]
    projects      projects[]

    @@index([name])
    @@index([division_id])
    @@index([created_at])
    @@index([updated_at])
    @@index([deleted_at])
}

model assets {
    id                Int           @id @default(autoincrement())
    name              String        @db.VarChar(255)
    description       String?       @db.Text
    asset_code        String        @unique @db.VarChar(100)
    category          AssetCategory
    brand             String?       @db.VarChar(100)
    model             String?       @db.VarChar(100)
    serial_number     String?       @unique @db.VarChar(100)
    purchase_date     DateTime?     @db.Date
    purchase_price    Decimal?      @db.Decimal(15, 2)
    warranty_end_date DateTime?     @db.Date
    location          String?       @db.VarChar(255)
    status            AssetStatus   @default(AVAILABLE)
    assigned_to       Int?
    assigned_user     users?        @relation("AssetAssignedUser", fields: [assigned_to], references: [id])
    assigned_date     DateTime?     @db.Date
    notes             String?       @db.Text
    created_by        Int
    creator           users         @relation("AssetCreator", fields: [created_by], references: [id])
    created_at        DateTime      @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at        DateTime      @updatedAt
    deleted_at        DateTime?     @db.DateTime()

    asset_requests asset_requests[]

    @@index([asset_code])
    @@index([category])
    @@index([status])
    @@index([assigned_to])
    @@index([created_by])
}

model asset_requests {
    id               Int                @id @default(autoincrement())
    user_id          Int
    user             users              @relation(fields: [user_id], references: [id])
    asset_id         Int?
    asset            assets?            @relation(fields: [asset_id], references: [id])
    request_type     AssetRequestType
    category         AssetCategory // Loại tài sản cần request
    description      String             @db.Text
    justification    String             @db.Text // Lý do cần tài sản
    priority         AssetPriority      @default(NORMAL)
    expected_date    DateTime?          @db.Date // Ngày mong muốn nhận
    status           AssetRequestStatus @default(PENDING)
    approved_by      Int?
    approver         users?             @relation("AssetRequestApprover", fields: [approved_by], references: [id])
    approved_at      DateTime?          @db.DateTime()
    rejection_reason String?            @db.Text
    fulfilled_at     DateTime?          @db.DateTime()
    returned_at      DateTime?          @db.DateTime()
    notes            String?            @db.Text
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt
    deleted_at       DateTime?          @db.DateTime()

    @@index([user_id])
    @@index([asset_id])
    @@index([status])
    @@index([request_type])
    @@index([category])
    @@index([approved_by])
}

model remote_work_requests {
    id               Int             @id @default(autoincrement())
    user_id          Int
    user             users           @relation(fields: [user_id], references: [id])
    work_date        DateTime        @db.Date
    remote_type      RemoteType      @default(REMOTE)
    duration         DayOffDuration  @default(FULL_DAY) // Thời gian làm từ xa: cả ngày, sáng, chiều
    title            String          @db.VarChar(255) // Tiêu đề đơn xin làm từ xa
    reason           String?         @db.Text // Lý do làm từ xa
    status           TimesheetStatus @default(PENDING)
    approved_by      Int? // ID người duyệt
    approved_by_user users?          @relation("RemoteWorkApprover", fields: [approved_by], references: [id])
    approved_at      DateTime?       @db.DateTime()
    rejected_reason  String?         @db.Text
    timesheet_id     Int? // Link tới timesheet
    timesheet        time_sheets?    @relation(fields: [timesheet_id], references: [id])
    created_at       DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime        @updatedAt
    deleted_at       DateTime?       @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_active")
    @@index([user_id])
    @@index([work_date])
    @@index([status])
    @@index([user_id, work_date])
    @@index([deleted_at])
    @@index([approved_by])
    @@index([created_at])
    @@index([remote_type])
    @@index([duration])
    @@index([timesheet_id])
}

model user_leave_balances {
    id                      Int       @id @default(autoincrement())
    user_id                 Int       @unique
    user                    users     @relation(fields: [user_id], references: [id])
    paid_leave_balance      Float     @default(0) // Số ngày phép có lương còn lại
    unpaid_leave_balance    Float     @default(0) // Số ngày phép không lương còn lại
    annual_paid_leave_quota Float     @default(36) // Hạn mức phép có lương/năm (3*12)
    carry_over_days         Float     @default(0) // Số ngày phép chuyển từ năm trước
    last_reset_date         DateTime? @db.Date // Lần cuối reset (đầu năm)
    created_at              DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at              DateTime  @updatedAt
    deleted_at              DateTime? @db.DateTime()

    @@index([user_id])
    @@index([deleted_at])
}

model leave_transactions {
    id               Int                  @id @default(autoincrement())
    user_id          Int
    user             users                @relation(fields: [user_id], references: [id])
    transaction_type LeaveTransactionType // EARNED, USED, ADJUSTED, CARRIED_OVER, EXPIRED
    leave_type       DayOffType // PAID, UNPAID, etc.
    amount           Float // Số ngày (+ là cộng, - là trừ)
    balance_after    Float // Số dư sau giao dịch
    reference_id     Int? // Link tới day_offs.id hoặc system job
    reference_type   String? // 'day_off', 'monthly_accrual', 'manual_adjustment'
    day_off_id       Int? // Direct reference to day_offs
    day_off          day_offs?            @relation("DayOffTransactions", fields: [day_off_id], references: [id])
    description      String?              @db.Text // Mô tả giao dịch
    created_at       DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime             @updatedAt
    deleted_at       DateTime?            @db.DateTime()

    @@index([user_id])
    @@index([transaction_type])
    @@index([leave_type])
    @@index([created_at])
    @@index([reference_id, reference_type])
    @@index([user_id, created_at])
    @@index([deleted_at])
    @@index([day_off_id]) // Index cho day_off relation
}

model late_early_requests {
    id               Int             @id @default(autoincrement())
    user_id          Int
    user             users           @relation(fields: [user_id], references: [id])
    work_date        DateTime        @db.Date // Ngày làm việc
    request_type     LateEarlyType // LATE, EARLY, BOTH
    title            String          @db.VarChar(255) // Tiêu đề đơn xin đi muộn/về sớm
    late_minutes     Int? // Số phút đi muộn (nếu có)
    early_minutes    Int? // Số phút về sớm (nếu có)
    reason           String          @db.Text // Lý do
    status           TimesheetStatus @default(PENDING) // PENDING, APPROVED, REJECTED
    approved_by      Int? // ID người duyệt
    approved_by_user users?          @relation("LateEarlyApprover", fields: [approved_by], references: [id])
    approved_at      DateTime?       @db.DateTime() // Thời gian duyệt
    rejected_reason  String?         @db.Text // Lý do từ chối
    timesheet_id     Int? // Link tới timesheet
    timesheet        time_sheets?    @relation(fields: [timesheet_id], references: [id])
    created_at       DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime        @updatedAt
    deleted_at       DateTime?       @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_late_early")
    @@index([user_id])
    @@index([work_date])
    @@index([status])
    @@index([request_type])
    @@index([user_id, work_date])
    @@index([deleted_at])
    @@index([approved_by])
    @@index([timesheet_id])
}

model forgot_checkin_requests {
    id               Int             @id @default(autoincrement())
    user_id          Int
    user             users           @relation(fields: [user_id], references: [id])
    work_date        DateTime        @db.Date // Ngày quên chấm công
    checkin_time     DateTime?       @db.DateTime() // Thời gian checkin thực tế
    checkout_time    DateTime?       @db.DateTime() // Thời gian checkout thực tế
    title            String          @db.VarChar(255) // Tiêu đề đơn xin bổ sung chấm công
    reason           String          @db.Text // Lý do quên chấm công
    status           TimesheetStatus @default(PENDING) // PENDING, APPROVED, REJECTED
    approved_by      Int? // ID người duyệt
    approved_by_user users?          @relation("ForgotCheckinApprover", fields: [approved_by], references: [id])
    approved_at      DateTime?       @db.DateTime() // Thời gian duyệt
    rejected_reason  String?         @db.Text // Lý do từ chối
    timesheet_id     Int? // Link tới timesheet
    timesheet        time_sheets?    @relation(fields: [timesheet_id], references: [id])
    created_at       DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime        @updatedAt
    deleted_at       DateTime?       @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_forgot_checkin")
    @@index([user_id])
    @@index([work_date])
    @@index([status])
    @@index([user_id, work_date])
    @@index([deleted_at])
    @@index([approved_by])
    @@index([timesheet_id])
}

model notifications {
    id                 Int                  @id @default(autoincrement())
    title              String               @db.VarChar(255)
    content            String               @db.Text
    news_id            Int?
    news               news?                @relation(fields: [news_id], references: [id])
    created_by         Int?
    creator            users?               @relation("NotificationCreator", fields: [created_by], references: [id])
    created_at         DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at         DateTime             @updatedAt
    deleted_at         DateTime?            @db.DateTime()
    user_notifications user_notifications[]

    @@index([news_id])
    @@index([created_by])
    @@index([created_at])
    @@index([deleted_at])
}

model user_notifications {
    id              Int           @id @default(autoincrement())
    notification_id Int
    notification    notifications @relation(fields: [notification_id], references: [id])
    user_id         Int
    user            users         @relation(fields: [user_id], references: [id])
    is_read         Boolean       @default(false)
    read_at         DateTime?     @db.DateTime()
    created_at      DateTime      @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at      DateTime      @updatedAt
    deleted_at      DateTime?     @db.DateTime()

    @@unique([notification_id, user_id])
    @@index([user_id])
    @@index([notification_id])
    @@index([is_read])
    @@index([created_at])
    @@index([deleted_at])
}

enum CerticicateType {
    ACHIEVEMENT
    CERTIFICATE
}

enum TimesheetStatus {
    PENDING
    APPROVED
    REJECTED
}

enum TimesheetType {
    NORMAL
    OVERTIME
    HOLIDAY
}

enum RemoteType {
    OFFICE
    REMOTE
    HYBRID
}

enum TimesheetRequestType {
    NORMAL
    OVERTIME
    HOLIDAY
}

enum DailyReportStatus {
    PENDING
    APPROVED
    REJECTED
}

enum CurrencyType {
    VND
    USD
    JPY
    EUR
}

enum ProjectStatus {
    OPEN
    IN_PROGRESS
    PENDING
    CANCELED
    GUARANTEE
    CLOSED
}

enum ProjectType {
    CUSTOMER
    IN_HOUSE
    START_UP
    INTERNAL
}

enum StageType {
    SPRINT
    LABO
    SOLUTION
    CONSTRUCTION
    TRANSITION
    GUARANTEE
}

enum UserInformationStatus {
    ACTIVE
    INACTIVE
}

enum StageStatus {
    OPEN
    IN_PROGRESS
    CLOSED
}

enum ReplanBy {
    BY_TEAM
    BY_CUSTOMER
}

enum DayOffStatus {
    PENDING
    APPROVED
    REJECTED
}

enum DayOffType {
    PAID
    UNPAID
    SICK
    MATERNITY
    PERSONAL
    COMPENSATORY
}

enum DayOffDuration {
    FULL_DAY
    MORNING
    AFTERNOON
}

enum ProcessType {
    ANALYSIS
    DESIGN
    DEVELOPMENT
    TESTING
    DEPLOYMENT
    MAINTENANCE
}

enum ToolType {
    JIRA
    REDMINE
    GITHUB
    GITLAB
    OTHER
}

enum LocationType {
    OFFICE
    REMOTE
    CLIENT_SITE
}

enum SessionType {
    WORK
    BREAK
    OVERTIME
}

enum ActionType {
    CHECKIN
    CHECKOUT
    BREAK_START
    BREAK_END
}

enum HolidayType {
    NATIONAL
    COMPANY
}

enum HolidayStatus {
    ACTIVE
    INACTIVE
}

enum WorkShiftType {
    NORMAL // Ca thường (hành chính)
    NIGHT // Ca đêm
    FLEXIBLE // Ca linh hoạt
    PART_TIME // Ca bán thời gian
    OVERTIME // Ca tăng ca
}

enum OtpType {
    PASSWORD_RESET
    CHANGE_PASSWORD
    EMAIL_VERIFICATION
}

enum ScopeType {
    COMPANY
    DIVISION
    TEAM
    PROJECT
}


enum AssetCategory {
    LAPTOP
    DESKTOP
    MONITOR
    KEYBOARD
    MOUSE
    HEADPHONE
    PHONE
    TABLET
    FURNITURE
    EQUIPMENT
    OTHER
}

enum AssetStatus {
    AVAILABLE // Có sẵn
    ASSIGNED // Đã gán
    MAINTENANCE // Bảo trì
    RETIRED // Ngừng sử dụng
    LOST // Mất
    DAMAGED // Hỏng
}

enum AssetRequestType {
    REQUEST // Yêu cầu cấp phát
    RETURN // Trả lại
    MAINTENANCE // Bảo trì
}

enum AssetRequestStatus {
    PENDING // Chờ duyệt
    APPROVED // Đã duyệt
    REJECTED // Từ chối
    FULFILLED // Đã giao
    RETURNED // Đã trả
    CANCELLED // Đã hủy
}

enum AssetPriority {
    LOW
    NORMAL
    HIGH
    URGENT
}

enum IndustryType {
    IT
    FINANCE
    MANUFACTURING
    OTHER
}

enum LeaveTransactionType {
    EARNED // Cộng phép (hàng tháng)
    USED // Sử dụng phép
    ADJUSTED // Điều chỉnh thủ công
    CARRIED_OVER // Chuyển từ năm trước
    EXPIRED // Hết hạn
}

enum LateEarlyType {
    LATE // Chỉ đi muộn
    EARLY // Chỉ về sớm
    BOTH // Cả đi muộn và về sớm
}


enum DivisionType {
    TECHNICAL
    BUSINESS
    OPERATIONS
    OTHER
}

enum DivisionStatus {
    ACTIVE
    INACTIVE
}

enum NewsStatus {
    DRAFT
    PENDING
    APPROVED
    REJECTED
}

model news {
    id            Int             @id @default(autoincrement())
    title         String          @db.VarChar(255)
    content       String          @db.Text
    status        NewsStatus      @default(DRAFT)
    author_id     Int
    author        users           @relation("NewsAuthor", fields: [author_id], references: [id])
    reason        String?         @db.Text
    reviewer_id   Int?
    reviewer      users?          @relation("NewsReviewer", fields: [reviewer_id], references: [id])
    reviewed_at   DateTime?       @db.DateTime()
    created_at    DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime        @updatedAt
    deleted_at    DateTime?       @db.DateTime()
    notifications notifications[]

    @@index([author_id])
    @@index([reviewer_id])
    @@index([status])
    @@index([created_at])
    @@index([deleted_at])
}


