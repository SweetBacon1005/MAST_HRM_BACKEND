generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model certificate_categories {
    id           Int            @id @default(autoincrement())
    name         String         @unique @db.VarChar(255)
    created_at   DateTime       @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at   DateTime       @updatedAt
    deleted_at   DateTime?      @db.DateTime(6)
    certificates certificates[]
}

model certificates {
    id                      Int                    @id @default(autoincrement())
    name                    String                 @unique @db.VarChar(255)
    certificate_category_id Int
    category                certificate_categories @relation(fields: [certificate_category_id], references: [id])
    created_at              DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at              DateTime               @updatedAt
    deleted_at              DateTime?              @db.DateTime(6)
    user_certificates       user_certificates[]

    @@index([certificate_category_id])
}

model education {
    id          Int       @id @default(autoincrement())
    user_id     Int
    user        users     @relation(fields: [user_id], references: [id])
    name        String    @db.VarChar(255)
    major       String    @db.VarChar(255)
    description String    @db.VarChar(255)
    start_date  DateTime  @db.Date
    end_date    DateTime  @db.Date
    created_at  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime  @updatedAt
    deleted_at  DateTime? @db.DateTime()

    @@index([user_id])
}

model experience {
    id         Int       @id @default(autoincrement())
    user_id    Int
    user       users     @relation(fields: [user_id], references: [id])
    job_title  String    @db.VarChar(255)
    company    String    @db.VarChar(255)
    start_date DateTime  @db.Date
    end_date   DateTime  @db.Date
    created_at DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime  @updatedAt
    deleted_at DateTime? @db.DateTime()

    @@index([user_id])
}

model divisions {
    id                       Int                        @id @default(autoincrement())
    name                     String
    is_active_project        Int                        @default(1)
    type                     Int?
    status                   Int?
    level                    Int?
    address                  String?
    parent_id                Int?
    parent                   divisions?                 @relation("DivisionParent", fields: [parent_id], references: [id])
    children                 divisions[]                @relation("DivisionParent")
    founding_at              DateTime
    description              String?
    total_member             Int?
    created_at               DateTime                   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at               DateTime                   @updatedAt
    deleted_at               DateTime?                  @db.DateTime(6)
    user_division            user_division[]
    rotation_member          rotation_members[]
    projects                 projects[]
    divisions_assignments    divisions_assignments[]
    divisions_monthly_counts divisions_monthly_counts[]

    @@index([parent_id])
    @@index([type])
    @@index([status])
    @@index([level])
}

model levels {
    id                   Int                    @id @default(autoincrement())
    name                 String                 @db.VarChar(255)
    coefficient          Float                  @db.Float
    created_at           DateTime               @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime               @updatedAt
    deleted_at           DateTime?              @db.DateTime(6)
    user_information     user_information[]
    evaluation_histories evaluation_histories[]
}

model migrations {
    id        Int    @id @default(autoincrement()) @db.UnsignedInt
    migration String @db.VarChar(255)
    batch     Int
}

model permissions {
    id              Int               @id @default(autoincrement())
    name            String            @unique @db.VarChar(255)
    created_at      DateTime          @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at      DateTime          @updatedAt
    deleted_at      DateTime?         @db.DateTime(6)
    permission_role permission_role[]
}

model positions {
    id                Int                @id @default(autoincrement())
    name              String             @db.VarChar(255)
    is_active_project Boolean            @default(false)
    created_at        DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at        DateTime           @updatedAt
    deleted_at        DateTime?          @db.DateTime(6)
    skills            skills[]
    user_information  user_information[]
}

model roles {
    id               Int                @id @default(autoincrement())
    name             String             @unique @db.VarChar(255)
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt
    deleted_at       DateTime?          @db.DateTime(6)
    user_information user_information[]
    user_division    user_division[]
    allocations      allocations[]
    permission_role  permission_role[]
}

model skills {
    id          Int           @id @default(autoincrement())
    name        String        @unique @db.VarChar(255)
    position_id Int
    position    positions     @relation(fields: [position_id], references: [id])
    created_at  DateTime      @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime      @updatedAt
    deleted_at  DateTime?     @db.DateTime(6)
    user_skills user_skills[]
    allocations allocations[]

    @@index([position_id])
}

model user_certificates {
    id             Int             @id @default(autoincrement())
    certificate_id Int
    certificate    certificates    @relation(fields: [certificate_id], references: [id])
    user_id        Int
    user           users           @relation(fields: [user_id], references: [id])
    name           String          @db.VarChar(255)
    authority      String          @db.VarChar(255)
    issued_at      DateTime        @db.DateTime()
    created_at     DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime        @updatedAt
    deleted_at     DateTime?       @db.DateTime(6)
    start_date     DateTime        @db.Date()
    type           CerticicateType @default(ACHIEVEMENT)

    @@index([user_id])
    @@index([issued_at])
    @@index([certificate_id])
}

model user_information {
    id             Int                   @id @default(autoincrement())
    user_id        Int                   @unique
    user           users                 @relation(fields: [user_id], references: [id])
    email          String                @db.VarChar(255)
    personal_email String                @db.VarChar(255)
    nationality    String                @db.VarChar(255)
    name           String                @db.VarChar(255)
    code           String                @db.VarChar(255)
    avatar         String                @db.VarChar(255)
    gender         String                @db.VarChar(255)
    marital        String                @db.VarChar(255)
    birthday       DateTime              @db.Date()
    position_id    Int
    position       positions             @relation(fields: [position_id], references: [id])
    address        String                @db.VarChar(255)
    temp_address   String                @db.VarChar(255)
    phone          String                @db.VarChar(255)
    tax_code       String                @db.VarChar(255)
    role_id        Int
    role           roles                 @relation(fields: [role_id], references: [id])
    status         UserInformationStatus @default(ACTIVE)
    description    String                @db.VarChar(255)
    level_id       Int
    level          levels                @relation(fields: [level_id], references: [id])
    note           String                @db.Text
    overview       String                @db.Text
    expertise      String                @db.VarChar(255)
    technique      String                @db.VarChar(255)
    main_task      String                @db.VarChar(255)
    language_id    Int
    language       languages             @relation(fields: [language_id], references: [id])
    created_at     DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime              @updatedAt
    deleted_at     DateTime?             @db.DateTime(6)

    @@index([user_id])
    @@index([position_id])
    @@index([role_id])
    @@index([level_id])
    @@index([language_id])
}

model languages {
    id               Int                @id @default(autoincrement())
    name             String             @db.VarChar(255)
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt
    deleted_at       DateTime?          @db.DateTime(6)
    user_information user_information[]

    @@index([name])
}

model user_skills {
    id                Int       @id @default(autoincrement()) @db.UnsignedInt
    skill_id          Int
    skill             skills    @relation(fields: [skill_id], references: [id])
    user_id           Int
    user              users     @relation(fields: [user_id], references: [id])
    experience        Int
    months_experience Int
    is_main           Boolean   @default(false)
    created_at        DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at        DateTime  @updatedAt
    deleted_at        DateTime? @db.DateTime(6)

    @@index([user_id])
    @@index([skill_id])
}

model activity_log {
    id           Int      @id @default(autoincrement())
    log_name     String   @db.VarChar(255)
    description  String   @db.Text
    subject_type String   @db.VarChar(255)
    event        String   @db.VarChar(255)
    subject_id   Int
    subject      users    @relation("Subject", fields: [subject_id], references: [id])
    causer_type  String   @db.VarChar(255)
    causer_id    Int
    causer       users    @relation("Causer", fields: [causer_id], references: [id])
    properties   Json
    batch_uuid   String   @db.Char(36)
    created_at   DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at   DateTime @updatedAt
}

model evaluation_histories {
    id         Int      @id @default(autoincrement())
    user_id    Int
    user       users    @relation(fields: [user_id], references: [id])
    date       DateTime @db.Date
    point      Float    @db.Double
    level_id   Int
    level      levels   @relation(fields: [level_id], references: [id])
    note       String?  @db.MediumText
    created_at DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime @updatedAt

    @@index([user_id])
    @@index([level_id])
    @@index([date])
}

model files {
    id            Int      @id @default(autoincrement())
    name          String   @db.VarChar(255)
    path          String   @db.VarChar(255)
    mime_type     String   @db.VarChar(255)
    type          Int
    fileable_id   Int
    fileable_type String   @db.VarChar(255)
    created_at    DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime @updatedAt

    @@index([fileable_type, fileable_id])
    @@index([type])
}

model permission_role {
    id            Int         @id @default(autoincrement())
    permission_id Int
    permission    permissions @relation(fields: [permission_id], references: [id])
    role_id       Int
    role          roles       @relation(fields: [role_id], references: [id])
    created_at    DateTime    @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime    @updatedAt

    @@index([permission_id])
    @@index([role_id])
}

model allocations {
    id          Int       @id @default(autoincrement())
    stage_id    Int
    stage       stages    @relation(fields: [stage_id], references: [id])
    user_id     Int
    user        users     @relation(fields: [user_id], references: [id])
    start_date  DateTime  @db.Date
    end_date    DateTime  @db.Date
    man_day     Int
    allocation  Int
    skill_id    Int
    skill       skills    @relation(fields: [skill_id], references: [id])
    coefficient Float     @db.Double
    created_at  DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime  @updatedAt
    role_id     Int
    role        roles     @relation(fields: [role_id], references: [id])
    deleted_at  DateTime? @db.DateTime()

    @@index([stage_id])
    @@index([user_id])
    @@index([skill_id])
    @@index([role_id])
    @@index([start_date, end_date])
}

model customer_project {
    id          Int       @id @default(autoincrement())
    customer_id Int
    customer    customers @relation(fields: [customer_id], references: [id])
    project_id  Int
    project     projects  @relation(fields: [project_id], references: [id])

    @@index([customer_id])
    @@index([project_id])
}

model customers {
    id               Int                @id @default(autoincrement())
    hubspot_id       String?            @db.VarChar(255)
    name             String             @db.VarChar(255)
    original_name    String?            @db.VarChar(255)
    code             String?            @db.VarChar(255)
    email            String?            @db.VarChar(255)
    phone            String?            @db.VarChar(255)
    city             String?            @db.VarChar(255)
    domain           String?            @db.VarChar(255)
    industry         String?            @db.VarChar(255)
    state            String?            @db.VarChar(255)
    address          String?            @db.LongText
    supporter        String?            @db.VarChar(255)
    note             String?            @db.LongText
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt
    customer_project customer_project[]

    @@index([hubspot_id])
    @@index([code])
    @@index([email])
    @@index([domain])
}

model daily_reports {
    id               Int                @id @default(autoincrement())
    user_id          Int
    user             users              @relation(fields: [user_id], references: [id])
    project_id       Int
    project          projects           @relation(fields: [project_id], references: [id])
    coefficient      Float              @db.Double
    tool_type        ToolType           @default(OTHER)
    issue_key        String?            @db.VarChar(255)
    title            String?            @db.MediumText
    work_date        DateTime           @db.Date
    process_type     ProcessType        @default(ANALYSIS)
    actual_time      Float              @db.Double
    status           DailyReportStatus? @default(PENDING)
    link_backlog     String?            @db.MediumText
    issue_properties Json?
    description      String?            @db.Text
    reject_reason    String?            @db.MediumText
    created_at       DateTime           @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime           @updatedAt

    @@index([user_id])
    @@index([project_id])
    @@index([work_date])
    @@index([status])
    @@index([issue_key])
}

model deliverables {
    id             Int               @id @default(autoincrement())
    stage_id       Int
    stage          stages            @relation(fields: [stage_id], references: [id])
    name           String            @db.VarChar(255)
    expected_date  DateTime          @db.Date
    status         DeliverableStatus @default(OPEN)
    replan_to_date DateTime          @db.Date
    actual_date    DateTime          @db.Date
    replan_by      ReplanBy?
    reason         String?           @db.LongText
    created_at     DateTime          @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime          @updatedAt
    deleted_at     DateTime?         @db.DateTime()

    @@index([stage_id])
    @@index([status])
    @@index([expected_date])
}

model milestones {
    id             Int               @id @default(autoincrement())
    stage_id       Int
    stage          stages            @relation(fields: [stage_id], references: [id])
    type           MilestoneType     @default(ANALYSIS)
    name           String            @db.VarChar(255)
    expected_date  DateTime          @db.Date
    status         DeliverableStatus @default(OPEN)
    replan_to_date DateTime          @db.Date
    actual_date    DateTime          @db.Date
    replan_by      ReplanBy?
    reason         String?           @db.LongText
    created_at     DateTime          @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime          @updatedAt

    @@index([stage_id])
    @@index([status])
    @@index([type])
    @@index([expected_date])
}

model otp_codes {
    id         Int      @id @default(autoincrement())
    email      String   @db.VarChar(255)
    code       String   @db.VarChar(6)
    type       OtpType  @default(PASSWORD_RESET)
    expires_at DateTime @db.DateTime()
    is_used    Boolean  @default(false)
    created_at DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime @updatedAt

    @@index([email])
    @@index([code])
    @@index([type])
    @@index([expires_at])
}

model pm_reports {
    id                        Int      @id @default(autoincrement())
    user_id                   Int
    user                      users    @relation(fields: [user_id], references: [id])
    project_id                Int
    project                   projects @relation(fields: [project_id], references: [id])
    date                      DateTime
    week                      String
    template_id               Int?
    customer_feedback         Int? // 1: good, 2: warning, 3: serious
    process_status            Int? // 1: good, 2: warning, 3: serious
    timeliness_status         Int? // 1: good, 2: warning, 3: serious
    quality_status            Int? // 1: good, 2: warning, 3: serious
    cost_status               Int? // 1: good, 2: warning, 3: serious
    cost_comment              String?
    quality_comment           String?
    timeliness_comment        String?
    process_comment           String?
    customer_feedback_comment String?
    note                      String?
    created_at                DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at                DateTime @updatedAt

    @@index([user_id])
    @@index([project_id])
}

model project_role_user {
    id                  Int      @id @default(autoincrement())
    project_id          Int
    user_id             Int
    role_id             Int
    position_in_project Int? // 1: monitor, 2: supporter, 3: implementor
    project             projects @relation(fields: [project_id], references: [id])
    user                users    @relation(fields: [user_id], references: [id])

    @@index([project_id])
    @@index([user_id])
}

model projects {
    id                   Int                  @id @default(autoincrement())
    name                 String
    code                 String
    status               ProjectStatus        @default(OPEN)
    division_id          Int?
    division             divisions?           @relation(fields: [division_id], references: [id])
    team_id              Int?
    team                 teams?               @relation(fields: [team_id], references: [id])
    contract_type        ContractType?
    project_type         ProjectType?
    billable             Float?
    budget               Float?
    rank                 Int?
    customer_type        CustomerType?
    industry             IndustryType?
    scope                String?
    number_process_apply Int?
    description          String?
    contract_information String?
    critical             String?
    note                 String?
    start_date           DateTime
    end_date             DateTime
    created_at           DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime             @updatedAt
    deleted_at           DateTime?            @db.DateTime()
    working_times        working_times[]
    project_role_user    project_role_user[]
    daily_reports        daily_reports[]
    stages               stages[]
    tasks                tasks[]
    customer_project     customer_project[]
    pm_reports           pm_reports[]
    over_times_history   over_times_history[]

    @@index([deleted_at])
    @@index([division_id])
    @@index([team_id])
}

model stages {
    id                Int            @id @default(autoincrement())
    project_id        Int
    project           projects       @relation(fields: [project_id], references: [id])
    type              StageType      @default(SPRINT)
    version           String
    status            StageStatus    @default(OPEN)
    start_date        DateTime
    end_date          DateTime
    replan_start_date DateTime
    replan_end_date   DateTime
    replan_by         ReplanBy?
    reason            String?
    description       String?
    created_at        DateTime       @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at        DateTime       @updatedAt
    deleted_at        DateTime?      @db.DateTime()
    deliverables      deliverables[]
    milestones        milestones[]
    allocations       allocations[]

    @@index([project_id])
    @@index([deleted_at])
}

model tasks {
    id             Int      @id @default(autoincrement())
    project_id     Int
    project        projects @relation(fields: [project_id], references: [id])
    issue_id       Int
    user_id        Int
    user           users    @relation(fields: [user_id], references: [id])
    title          String
    issue_type     String
    status         String
    start_date     DateTime
    due_date       DateTime
    estimate_hours Int?
    actual_hours   Int?
    billable       Int?
    created_at     DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime @updatedAt

    @@index([project_id])
    @@index([issue_id])
    @@index([user_id])
}

model users {
    id                            Int                     @id @default(autoincrement())
    name                          String?                 @db.VarChar(255)
    email                         String                  @unique @db.VarChar(255)
    email_verified_at             DateTime                @db.DateTime()
    password                      String?                 @db.VarChar(255)
    created_at                    DateTime                @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at                    DateTime                @updatedAt
    deleted_at                    DateTime?               @db.DateTime()
    education                     education[]
    experience                    experience[]
    user_certificates             user_certificates[]
    user_information              user_information[]
    user_skills                   user_skills[]
    rotation_members              rotation_members[]
    user_division                 user_division[]
    attendance_logs               attendance_logs[]
    attendance_sessions           attendance_sessions[]
    day_offs                      day_offs[]              @relation("user")
    approved_by_user              day_offs[]              @relation("approved_by_user")
    working_times                 working_times[]
    project_role_user             project_role_user[]
    time_sheets                   time_sheets[]
    contracts                     contracts[]
    work_times                    work_times[]
    tasks                         tasks[]
    allocations                   allocations[]
    pm_reports                    pm_reports[]
    user_devices                  user_devices[]
    daily_reports                 daily_reports[]
    divisions_assignments         divisions_assignments[]
    team_member_resources         team_member_resources[]
    evaluation_histories          evaluation_histories[]
    activity_log_subject          activity_log[]          @relation("Subject")
    activity_log_causer           activity_log[]          @relation("Causer")
    remote_work_requests          remote_work_requests[]
    approved_remote_work_requests remote_work_requests[]  @relation("RemoteWorkApprover")
    over_times_history_approved   over_times_history[]    @relation("approved_by_user")
    over_times_history_subject    over_times_history[]    @relation("user")
    user_leave_balance            user_leave_balances?
    leave_transactions            leave_transactions[]
    late_early_requests           late_early_requests[]
    approved_late_early_requests  late_early_requests[]   @relation("LateEarlyApprover")
}

model working_times {
    id         Int      @id @default(autoincrement())
    user_id    Int
    user       users    @relation(fields: [user_id], references: [id])
    project_id Int
    project    projects @relation(fields: [project_id], references: [id])
    date       DateTime @db.Date
    time_in    DateTime @db.DateTime()
    time_out   DateTime @db.DateTime()
    created_at DateTime @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime @updatedAt

    @@index([user_id])
    @@index([project_id])
    @@index([date])
}

model block_times {
    id                   Int       @id @default(autoincrement())
    block                Int
    minutes              Int
    money                Float     @db.Double
    time_late_early      Int
    next_time_late_early Int
    created_at           DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime  @updatedAt
    deleted_at           DateTime? @db.DateTime()

    @@index([block])
}

model checkouts {
    id            Int      @id @default(autoincrement())
    user_id       Int
    checkout_date DateTime @db.Date
    status        Int
    request_id    Int?

    created_at DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime  @updatedAt
    deleted_at DateTime? @db.DateTime()

    @@index([user_id])
    @@index([request_id])
}

model contracts {
    id                    Int                     @id @default(autoincrement())
    user_id               Int
    user                  users                   @relation(fields: [user_id], references: [id])
    code                  String                  @db.VarChar(255)
    contract_category     Int
    status                ContractStatus?         @default(ACTIVE) // 0: active, 1: inactive
    type                  Boolean
    start_date            DateTime                @db.Date
    end_date              DateTime                @db.Date
    author_id             Int?
    editor_id             Int?
    created_at            DateTime                @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at            DateTime                @updatedAt
    deleted_at            DateTime?               @db.DateTime()
    work_times            work_times[]
    divisions_assignments divisions_assignments[]
    team_member_resources team_member_resources[]

    @@index([user_id])
    @@index([contract_category])
    @@index([author_id])
    @@index([editor_id])
    @@index([deleted_at])
}

model day_offs {
    id                       Int                  @id @default(autoincrement())
    user_id                  Int
    user                     users                @relation("user", fields: [user_id], references: [id])
    work_date                DateTime             @db.Date // Ngày nghỉ
    duration                 DayOffDuration       @default(FULL_DAY)
    status                   DayOffStatus         @default(PENDING)
    type                     DayOffType           @default(PAID)
    title                    String               @db.VarChar(255) // Tiêu đề đơn xin nghỉ
    reason                   String?              @db.Text // Lý do nghỉ phép
    approved_by              Int? // ID người duyệt
    approved_by_user         users?               @relation("approved_by_user", fields: [approved_by], references: [id])
    approved_at              DateTime?            @db.DateTime() // Thời gian duyệt
    rejected_reason          String?              @db.Text // Lý do từ chối
    is_past                  Boolean              @default(false) // Nghỉ phép bù (đã làm trước)
    balance_deducted         Boolean              @default(false) // Đã trừ leave balance chưa
    deduction_transaction_id Int? // ID của leave transaction khi trừ balance
    created_at               DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at               DateTime             @updatedAt
    deleted_at               DateTime?            @db.DateTime()
    time_sheets              time_sheets[]
    leave_transactions       leave_transactions[] @relation("DayOffTransactions")

    @@index([user_id])
    @@index([status])
    @@index([work_date])
    @@index([user_id, status]) // Để lọc day off theo user và trạng thái
    @@index([user_id, work_date]) // Để tìm nghỉ phép theo ngày
    @@index([duration]) // Để lọc theo loại nghỉ (cả ngày/nửa ngày)
    @@index([deleted_at]) // Để tối ưu soft delete queries
    @@index([approved_by])
    @@index([balance_deducted]) // Để tìm các đơn đã/chưa trừ balance
    @@index([deduction_transaction_id]) // Để link với transaction
}

model divisions_assignments {
    id          Int        @id @default(autoincrement())
    division_id Int
    division    divisions  @relation(fields: [division_id], references: [id])
    user_id     Int
    user        users      @relation(fields: [user_id], references: [id])
    start_date  DateTime   @db.Date
    end_date    DateTime   @db.Date
    contract_id Int?
    contract    contracts? @relation(fields: [contract_id], references: [id])
    note        String?    @db.MediumText
    created_at  DateTime   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime   @updatedAt

    @@index([division_id])
    @@index([user_id])
    @@index([contract_id])
}

model divisions_monthly_counts {
    id           Int       @id @default(autoincrement())
    division_id  Int
    division     divisions @relation(fields: [division_id], references: [id])
    total_member Int
    date         DateTime  @db.Date
    created_at   DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at   DateTime  @updatedAt
    deleted_at   DateTime? @db.DateTime()

    @@index([division_id, date])
}

model holidays {
    id          Int           @id @default(autoincrement())
    name        String        @db.VarChar(255)
    type        HolidayType
    status      HolidayStatus
    start_date  DateTime      @db.Date
    end_date    DateTime      @db.Date
    description String?       @db.VarChar(255)
    created_at  DateTime      @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime      @updatedAt
    deleted_at  DateTime?     @db.DateTime()

    @@index([start_date])
    @@index([end_date])
    @@index([start_date, end_date]) // Để lọc holiday theo khoảng thời gian
    @@index([status])
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model time_sheets {
    id                  Int                   @id @default(autoincrement())
    user_id             Int
    user                users                 @relation(fields: [user_id], references: [id])
    work_date           DateTime              @db.Date // Ngày làm việc
    checkin             DateTime?             @db.DateTime() // Thời gian check in
    checkout            DateTime?             @db.DateTime() // Thời gian check out
    checkin_checkout    String?
    day_off_id          Int?
    day_off             day_offs?             @relation(fields: [day_off_id], references: [id])
    late_time           Int? // Phút đi muộn
    late_time_approved  Int? // Phút đi muộn được duyệt
    early_time          Int? // Phút về sớm
    early_time_approved Int? // Phút về sớm được duyệt
    is_complete         Boolean?              @default(false) // Hoàn thành đủ giờ làm việc (0: chưa, 1: đủ)
    fines               Float? // Tiền phạt
    deleted_at          DateTime?             @db.DateTime()
    created_at          DateTime              @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at          DateTime              @updatedAt
    type                TimesheetType?        @default(NORMAL) // Loại timesheet (1: normal, 2: overtime, 3: holiday)
    work_time_morning   Int? // Phút làm việc buổi sáng
    work_time_afternoon Int? // Phút làm việc buổi chiều
    status              TimesheetStatus?      @default(PENDING) // Trạng thái (0: pending, 1: approved, 2: rejected)
    request_type        TimesheetRequestType? @default(NORMAL) // Loại yêu cầu
    request_late        String? // Lý do xin phép đi muộn
    request_early       String? // Lý do xin phép về sớm
    remote              RemoteType?           @default(OFFICE) // Làm việc từ xa (0: office, 1: remote, 2: hybrid)
    total_work_time     Int? // Tổng thời gian làm việc (phút)
    break_time          Int? // Thời gian nghỉ trưa (phút)
    attendance_logs     attendance_logs[] // Relation với attendance_logs
    attendance_sessions attendance_sessions[] // Relation với attendance_sessions
    late_early_requests late_early_requests[] // Relation với late_early_requests

    @@unique([user_id, work_date]) // Mỗi user chỉ có 1 timesheet/ngày
    @@index([user_id])
    @@index([work_date])
    @@index([user_id, work_date])
    @@index([day_off_id])
    @@index([status])
    @@index([type])
    @@index([work_date, status]) // Để lọc theo ngày và trạng thái
    @@index([user_id, status]) // Để lọc theo user và trạng thái
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model attendance_sessions {
    id             Int              @id @default(autoincrement())
    user_id        Int
    user           users            @relation(fields: [user_id], references: [id])
    timesheet_id   Int? // Link tới time_sheets
    timesheet      time_sheets?     @relation(fields: [timesheet_id], references: [id])
    work_date      DateTime         @db.Date // Ngày làm việc
    session_type   SessionType // 'work', 'break', 'overtime'
    checkin_time   DateTime?        @db.DateTime() // Thời gian vào
    checkout_time  DateTime?        @db.DateTime() // Thời gian ra
    duration       Int? // Thời lượng (phút)
    is_open        Boolean          @default(true) // Phiên đã đóng chưa
    location_type  LocationType? // 'office', 'remote', 'client_site'
    checkin_photo  String?          @db.VarChar(500) // Ảnh selfie check in
    checkout_photo String?          @db.VarChar(500) // Ảnh selfie check out
    note           String?          @db.Text // Ghi chú
    status         TimesheetStatus? @default(PENDING) // 0: pending, 1: approved, 2: rejected
    created_at     DateTime         @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at     DateTime         @updatedAt
    deleted_at     DateTime?        @db.DateTime()

    attendance_logs attendance_logs[] // Relation với attendance_logs

    @@index([user_id])
    @@index([work_date])
    @@index([user_id, work_date])
    @@index([session_type])
    @@index([checkin_time])
    @@index([checkout_time])
    @@index([timesheet_id])
    @@index([status])
    @@index([user_id, work_date, session_type]) // Để tìm session theo user, ngày và loại
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model attendance_logs {
    id              Int                  @id @default(autoincrement())
    user_id         Int
    user            users                @relation(fields: [user_id], references: [id])
    timesheet_id    Int? // Link tới time_sheets
    timesheet       time_sheets?         @relation(fields: [timesheet_id], references: [id])
    session_id      Int? // Link tới attendance_sessions
    session         attendance_sessions? @relation(fields: [session_id], references: [id])
    action_type     String               @db.VarChar(20) // 'checkin', 'checkout', 'break_start', 'break_end'
    timestamp       DateTime             @db.DateTime() // Thời gian thực hiện hành động
    work_date       DateTime             @db.Date // Ngày làm việc
    location_type   String?              @db.VarChar(20) // 'office', 'remote', 'client_site'
    photo_url       String?              @db.VarChar(500) // Ảnh selfie check in/out
    note            String?              @db.Text // Ghi chú
    itempodency_key String?              @db.VarChar(255) // Mã định danh check in/out từ thiết bị
    is_manual       Boolean              @default(false) // Check in/out thủ công bởi admin
    status          TimesheetStatus?     @default(PENDING) // 0: pending, 1: approved, 2: rejected
    created_at      DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at      DateTime             @updatedAt
    deleted_at      DateTime?            @db.DateTime()

    @@index([user_id])
    @@index([work_date])
    @@index([user_id, work_date])
    @@index([action_type])
    @@index([timestamp])
    @@index([timesheet_id])
    @@index([session_id])
    @@index([status])
    @@index([itempodency_key])
    @@index([user_id, action_type, work_date]) // Để kiểm tra checkin/checkout trong ngày
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model team_member_resources {
    id          Int        @id @default(autoincrement())
    team_id     Int
    team        teams      @relation(fields: [team_id], references: [id])
    user_id     Int
    user        users      @relation(fields: [user_id], references: [id])
    contract_id Int
    contract    contracts? @relation(fields: [contract_id], references: [id])
    start_date  DateTime
    end_date    DateTime
    note        String?
    created_at  DateTime   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime   @updatedAt

    @@index([team_id])
    @@index([user_id])
    @@index([contract_id])
}

model schedule_works {
    id                   Int            @id @default(autoincrement())
    start_date           DateTime
    end_date             DateTime
    hour_start_morning   DateTime
    hour_end_morning     DateTime
    hour_start_afternoon DateTime
    hour_end_afternoon   DateTime
    type                 WorkShiftType? @default(NORMAL)
    name                 String?
    created_at           DateTime       @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at           DateTime       @updatedAt
    deleted_at           DateTime?      @db.DateTime()

    @@index([start_date])
    @@index([end_date])
    @@index([type])
}

model rotation_members {
    id            Int       @id @default(autoincrement())
    division_id   Int
    division      divisions @relation(fields: [division_id], references: [id])
    user_id       Int
    user          users     @relation(fields: [user_id], references: [id])
    type          Int?
    date_rotation DateTime
    created_at    DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime  @updatedAt
    deleted_at    DateTime? @db.DateTime()

    @@index([division_id])
    @@index([user_id])
}

model over_times_history {
    id               Int              @id @default(autoincrement())
    user_id          Int
    user             users            @relation("user", fields: [user_id], references: [id])
    work_date        DateTime         @db.Date // Ngày làm tăng ca
    title            String           @db.VarChar(255) // Tiêu đề đơn xin tăng ca
    start_time       DateTime         @db.Time() // Thời gian bắt đầu (chỉ giờ:phút)
    end_time         DateTime         @db.Time() // Thời gian kết thúc (chỉ giờ:phút)
    total_hours      Float? // Tổng số giờ tăng ca
    hourly_rate      Float? // Mức lương theo giờ
    total_amount     Float? // Tổng tiền tăng ca
    project_id       Int?
    project          projects?        @relation(fields: [project_id], references: [id])
    reason           String?          @db.Text // Lý do tăng ca
    status           TimesheetStatus? @default(PENDING)
    approved_by      Int? // ID người duyệt
    approved_by_user users?           @relation("approved_by_user", fields: [approved_by], references: [id])
    approved_at      DateTime?        @db.DateTime()
    rejected_reason  String?          @db.Text
    created_at       DateTime         @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime         @updatedAt
    deleted_at       DateTime?        @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_overtime")
    @@index([user_id])
    @@index([work_date])
    @@index([project_id])
    @@index([user_id, work_date]) // Để lọc overtime theo user và ngày
    @@index([status])
    @@index([approved_by])
    @@index([deleted_at]) // Để tối ưu soft delete queries
}

model over_times {
    id                 Int       @id @default(autoincrement())
    type               Int?
    start_first_shift  DateTime
    end_first_shift    DateTime
    first_coefficient  Float?
    start_second_shift DateTime
    end_second_shift   DateTime
    second_coefficient Float?
    start_third_shift  DateTime
    end_third_shift    DateTime
    third_coefficient  Float?
    created_at         DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at         DateTime  @updatedAt
    deleted_at         DateTime? @db.DateTime()
}

model work_times {
    id         Int        @id @default(autoincrement())
    userId     Int
    user       users      @relation(fields: [userId], references: [id])
    startDate  DateTime
    total      Int?
    status     Int?
    contractId Int?
    contract   contracts? @relation(fields: [contractId], references: [id])
    created_at DateTime   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at DateTime   @updatedAt
    deleted_at DateTime?  @db.DateTime()

    @@index([userId])
    @@index([contractId])
    @@index([startDate])
    @@index([status])
    @@index([deleted_at])
}

model user_division {
    id          Int        @id @default(autoincrement())
    userId      Int
    user        users      @relation(fields: [userId], references: [id])
    role_id     Int?
    role        roles?     @relation(fields: [role_id], references: [id])
    divisionId  Int?
    division    divisions? @relation(fields: [divisionId], references: [id])
    teamId      Int?
    team        teams?     @relation(fields: [teamId], references: [id])
    description String?
    teamLeader  Int?
    created_at  DateTime   @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at  DateTime   @updatedAt

    @@index([userId])
    @@index([role_id])
    @@index([divisionId])
    @@index([teamId])
    @@index([teamLeader])
}

model teams {
    id                    Int                     @id @default(autoincrement())
    name                  String                  @db.VarChar(255)
    created_at            DateTime                @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at            DateTime                @updatedAt
    deleted_at            DateTime?               @db.DateTime()
    user_division         user_division[]
    projects              projects[]
    team_member_resources team_member_resources[]

    @@index([name])
    @@index([created_at])
    @@index([updated_at])
    @@index([deleted_at])
}

enum CerticicateType {
    ACHIEVEMENT
    CERTIFICATE
}

enum TimesheetStatus {
    PENDING
    APPROVED
    REJECTED
}

enum TimesheetType {
    NORMAL
    OVERTIME
    HOLIDAY
}

enum RemoteType {
    OFFICE
    REMOTE
    HYBRID
}

enum TimesheetRequestType {
    NORMAL
    OVERTIME
    HOLIDAY
}

enum DailyReportStatus {
    PENDING
    APPROVED
    REJECTED
}

enum ContractStatus {
    ACTIVE
    INACTIVE
}

enum CurrencyType {
    VND
    USD
    JPY
    EUR
}

enum ProjectStatus {
    OPEN
    IN_PROGRESS
    PENDING
    CANCELED
    GUARANTEE
    CLOSED
}

enum ContractType {
    LABO
    FIXED_PRICE
}

enum ProjectType {
    CUSTOMER
    IN_HOUSE
    START_UP
    INTERNAL
}

enum CustomerType {
    SI_COMPANY
    END_USER
}

enum StageType {
    SPRINT
    LABO
    SOLUTION
    CONSTRUCTION
    TRANSITION
    GUARANTEE
}

enum UserInformationStatus {
    ACTIVE
    INACTIVE
}

enum StageStatus {
    OPEN
    IN_PROGRESS
    CLOSED
}

enum ReplanBy {
    BY_TEAM
    BY_CUSTOMER
}

enum DeliverableStatus {
    OPEN
    CLOSED
}

enum MilestoneType {
    ANALYSIS
    DESIGN
    DEVELOPMENT
    TESTING
}

enum DayOffStatus {
    PENDING
    APPROVED
    REJECTED
}

enum DayOffType {
    PAID
    UNPAID
    SICK
    MATERNITY
    PERSONAL
    COMPENSATORY
}

enum DayOffDuration {
    FULL_DAY
    MORNING
    AFTERNOON
}

enum ProcessType {
    ANALYSIS
    DESIGN
    DEVELOPMENT
    TESTING
    DEPLOYMENT
    MAINTENANCE
}

enum ToolType {
    JIRA
    REDMINE
    GITHUB
    GITLAB
    OTHER
}

enum LocationType {
    OFFICE
    REMOTE
    CLIENT_SITE
}

enum SessionType {
    WORK
    BREAK
    OVERTIME
}

enum ActionType {
    CHECKIN
    CHECKOUT
    BREAK_START
    BREAK_END
}

enum HolidayType {
    NATIONAL
    COMPANY
}

enum HolidayStatus {
    ACTIVE
    INACTIVE
}

enum WorkShiftType {
    NORMAL // Ca thường (hành chính)
    NIGHT // Ca đêm
    FLEXIBLE // Ca linh hoạt
    PART_TIME // Ca bán thời gian
    OVERTIME // Ca tăng ca
}

enum OtpType {
    PASSWORD_RESET
    CHANGE_PASSWORD
    EMAIL_VERIFICATION
}

model user_devices {
    id            Int          @id @default(autoincrement())
    user_id       Int
    user          users        @relation(fields: [user_id], references: [id])
    device_name   String       @db.VarChar(255)
    device_type   DeviceType   @default(LAPTOP)
    device_serial String?      @db.VarChar(255)
    assigned_date DateTime     @db.Date
    returned_date DateTime?    @db.Date
    status        DeviceStatus @default(ACTIVE)
    notes         String?      @db.Text
    created_at    DateTime     @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at    DateTime     @updatedAt
    deleted_at    DateTime?    @db.DateTime()

    @@index([user_id])
    @@index([device_type])
    @@index([status])
    @@index([assigned_date])
}

enum DeviceType {
    LAPTOP
    DESKTOP
    MONITOR
    KEYBOARD
    MOUSE
    HEADPHONE
    OTHER
}

enum DeviceStatus {
    ACTIVE
    RETURNED
    LOST
    DAMAGED
}

enum IndustryType {
    IT
    FINANCE
    MANUFACTURING
    OTHER
}

enum LeaveTransactionType {
    EARNED // Cộng phép (hàng tháng)
    USED // Sử dụng phép
    ADJUSTED // Điều chỉnh thủ công
    CARRIED_OVER // Chuyển từ năm trước
    EXPIRED // Hết hạn
}

enum LateEarlyType {
    LATE // Chỉ đi muộn
    EARLY // Chỉ về sớm
    BOTH // Cả đi muộn và về sớm
}

model remote_work_requests {
    id               Int             @id @default(autoincrement())
    user_id          Int
    user             users           @relation(fields: [user_id], references: [id])
    work_date        DateTime        @db.Date
    remote_type      RemoteType      @default(REMOTE)
    title            String          @db.VarChar(255) // Tiêu đề đơn xin làm từ xa
    reason           String?         @db.Text // Lý do làm từ xa
    status           TimesheetStatus @default(PENDING)
    approved_by      Int? // ID người duyệt
    approved_by_user users?          @relation("RemoteWorkApprover", fields: [approved_by], references: [id])
    approved_at      DateTime?       @db.DateTime()
    rejected_reason  String?         @db.Text
    created_at       DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime        @updatedAt
    deleted_at       DateTime?       @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_active")
    @@index([user_id])
    @@index([work_date])
    @@index([status])
    @@index([user_id, work_date])
    @@index([deleted_at])
    @@index([approved_by])
    @@index([created_at])
    @@index([remote_type])
}

model user_leave_balances {
    id                      Int       @id @default(autoincrement())
    user_id                 Int       @unique
    user                    users     @relation(fields: [user_id], references: [id])
    paid_leave_balance      Float     @default(0) // Số ngày phép có lương còn lại
    unpaid_leave_balance    Float     @default(0) // Số ngày phép không lương còn lại
    annual_paid_leave_quota Float     @default(36) // Hạn mức phép có lương/năm (3*12)
    carry_over_days         Float     @default(0) // Số ngày phép chuyển từ năm trước
    last_reset_date         DateTime? @db.Date // Lần cuối reset (đầu năm)
    created_at              DateTime  @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at              DateTime  @updatedAt
    deleted_at              DateTime? @db.DateTime()

    @@index([user_id])
    @@index([deleted_at])
}

model leave_transactions {
    id               Int                  @id @default(autoincrement())
    user_id          Int
    user             users                @relation(fields: [user_id], references: [id])
    transaction_type LeaveTransactionType // EARNED, USED, ADJUSTED, CARRIED_OVER, EXPIRED
    leave_type       DayOffType // PAID, UNPAID, etc.
    amount           Float // Số ngày (+ là cộng, - là trừ)
    balance_after    Float // Số dư sau giao dịch
    reference_id     Int? // Link tới day_offs.id hoặc system job
    reference_type   String? // 'day_off', 'monthly_accrual', 'manual_adjustment'
    day_off_id       Int? // Direct reference to day_offs
    day_off          day_offs?            @relation("DayOffTransactions", fields: [day_off_id], references: [id])
    description      String?              @db.Text // Mô tả giao dịch
    created_at       DateTime             @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime             @updatedAt
    deleted_at       DateTime?            @db.DateTime()

    @@index([user_id])
    @@index([transaction_type])
    @@index([leave_type])
    @@index([created_at])
    @@index([reference_id, reference_type])
    @@index([user_id, created_at])
    @@index([deleted_at])
    @@index([day_off_id]) // Index cho day_off relation
}

model late_early_requests {
    id               Int             @id @default(autoincrement())
    user_id          Int
    user             users           @relation(fields: [user_id], references: [id])
    work_date        DateTime        @db.Date // Ngày làm việc
    request_type     LateEarlyType // LATE, EARLY, BOTH
    title            String          @db.VarChar(255) // Tiêu đề đơn xin đi muộn/về sớm
    late_minutes     Int? // Số phút đi muộn (nếu có)
    early_minutes    Int? // Số phút về sớm (nếu có)
    reason           String          @db.Text // Lý do
    status           TimesheetStatus @default(PENDING) // PENDING, APPROVED, REJECTED
    approved_by      Int? // ID người duyệt
    approved_by_user users?          @relation("LateEarlyApprover", fields: [approved_by], references: [id])
    approved_at      DateTime?       @db.DateTime() // Thời gian duyệt
    rejected_reason  String?         @db.Text // Lý do từ chối
    timesheet_id     Int? // Link tới timesheet
    timesheet        time_sheets?    @relation(fields: [timesheet_id], references: [id])
    created_at       DateTime        @default(dbgenerated("CURRENT_TIMESTAMP")) @db.Timestamp(0)
    updated_at       DateTime        @updatedAt
    deleted_at       DateTime?       @db.DateTime()

    @@unique([user_id, work_date, deleted_at], name: "unique_user_work_date_late_early")
    @@index([user_id])
    @@index([work_date])
    @@index([status])
    @@index([request_type])
    @@index([user_id, work_date])
    @@index([deleted_at])
    @@index([approved_by])
    @@index([timesheet_id])
}
